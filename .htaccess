# ======== HABILITA REWRITE ENGINE ========
RewriteEngine On

# ======== GARANTE PROCESSAMENTO PHP ========
# Tenta diferentes métodos dependendo da configuração do servidor
<IfModule mod_php7.c>
    AddHandler application/x-httpd-php .php
    AddType application/x-httpd-php .php
</IfModule>
<IfModule mod_php8.c>
    AddHandler application/x-httpd-php .php
    AddType application/x-httpd-php .php
</IfModule>
<IfModule mod_php.c>
    AddHandler application/x-httpd-php .php
    AddType application/x-httpd-php .php
</IfModule>

# Garante que arquivos PHP sejam processados
<FilesMatch "\.php$">
    SetHandler application/x-httpd-php
    AddType application/x-httpd-php .php
</FilesMatch>

# ======== VARIÁVEIS DE AMBIENTE PARA SMTP ========
# Nota: Alguns servidores não permitem SetEnv, então as credenciais estão também no código como fallback
SetEnv SMTP_HOST "smtp.task.com.br"
SetEnv SMTP_PORT "465"
SetEnv SMTP_USER "flumen@flumenconsultoria.com.br"
SetEnv SMTP_PASS "Aguaboa22"
SetEnv SMTP_SSL "1"
SetEnv MAIL_TO "flumen@flumenconsultoria.com.br"

# ======== REDIRECIONAMENTO DE URLs AMIGÁVEIS ========
# Redireciona URLs com .html para versão sem extensão (301 permanente)
RewriteCond %{THE_REQUEST} /([^.]+)\.html [NC]
RewriteRule ^ /%1? [NC,L,R=301]

# Remove .html das URLs e redireciona para versão sem extensão
# Mas não aplica para arquivos PHP
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !\.php$ [NC]
RewriteRule ^([^\.]+)$ $1.html [NC,L]

# ======== PROTEÇÃO DE ARQUIVOS SENSÍVEIS ========
# Protege arquivos de configuração
<FilesMatch "\.(htaccess|htpasswd|ini|log|sh|sql)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# ======== CONFIGURAÇÕES DE SEGURANÇA ========
# Previne listagem de diretórios
Options -Indexes

# Protege contra injeção de código
<IfModule mod_php7.c>
    php_flag display_errors Off
    php_flag log_errors On
    # Habilita funções necessárias para SMTP
    php_flag allow_url_fopen On
</IfModule>
<IfModule mod_php8.c>
    php_flag display_errors Off
    php_flag log_errors On
    php_flag allow_url_fopen On
</IfModule>

# ======== COMPRESSÃO ========
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# ======== CACHE ========
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/html "access plus 0 seconds"
</IfModule>

